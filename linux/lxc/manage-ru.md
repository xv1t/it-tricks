# Управление контейнерами LXC
>Контенеры LXC работают в окружении привелигированного пользователя `root`

Перед управлением нужно либо перейти в режим `root`, либо запускать в сеансе непривелигированного пользователя через `sudo`.

## Переключение в оболочку `root`
Запрос пароля будет один раз
```bash
user@host: # sudo -i
password: ******
root@host: $
```

## Запуск команд с правами `root`
Запрос пароля будет один раз, но через некоторое время может повторяться.
```bash
user@host: # sudo lxc-ls -f
password: *****
```

# Просмотр списка контейнеров
```bash
$ lxc-ls -f
NAME STATE   AUTOSTART GROUPS IPV4          IPV6 
fs03 RUNNING 0         -      192.168.20.20 -  
```
В данном примере доступен один контейнер со статусом `RUNNING` - значит запущен.
Статус `STOPPED` -  не запущен

# Запуск контейнера
```bash
lxc-start -n "fs03"
```
Будет запуск контейнера `fs03`.

## Запуск нескольких контейнеров
```bash
lxc-start -n "fs01"
lxc-start -n "fs02"
lxc-start -n "fs03"
```

## Скрипт запуска нескольких контейнеров
Например в автозапуске - файл `/etc/rc.local`
```bash
lxc-start -n "fs01"
lxc-start -n "fs02"
lxc-start -n "fs03"
```
Пример запуска в цикле
```bash
for lxc in fs01 fs02 fs03 db01 sql01; do
  lxc-start -n $lxc;
done
```
# Останов контейнера
>Если на контейнере есть службы, например,  mysql, то виртуальную машину лучше выключать классически, подключившись к ней по `SSH` и выключить командой `sudo poweroff`. После этого вирт машина корректно завершит все службы и выключиться. И в статусе `STATE` будет `STOPPED`

Принудительно из хоста
```bash
lxc-stop -n "fs01"
```
# Автозапуск при включении сервера
> Добавить в скрипт `/etc/rc.local` команды запуска всех необходимых LXC контейнеров

# Файлы контейнеров, перенос
Все контейнеры расположены в директории `/var/lib/lxc`. Эта папка может быть ссылкой, например, на `/srv/data`

Соотвественно папку контйнера можно скопировать, и перенести на другой сервер. 

Главные условия переноса:
1. Целевой сервер имеет сетевой мост (bridge) с таким же названием, например, `lanbr0`
2. Папка контейнера заархирована `tar` с сохранением всех атрибутов файлов
